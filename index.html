<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>D3 Test</title>
        <style>
            .land {
                fill: #444;
            }
            
            .county-boundary {
                fill: none;
                stroke: #fff;
                stroke-width: .5px;
            }
            .state-boundary {
                fill: none:
                stroke: #fff;
            }
            .glyph {
                fill: #000;
            }
        </style>
        <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
        <script src="http://d3js.org/topojson.v1.min.js"></script>
        <script src="papaparse.min.js"></script>
        <script src="jquery-2.1.3.js"></script>
        </head>
        <body>
        <script type="text/javascript">
            var width = 960,
                height = 480;

            var projection = d3.geo.albersUsa()
                .scale(1000)
                .translate([width / 2, height / 2]);
            var path = d3.geo.path()
                .projection(projection);
            var graticule = d3.geo.graticule()

            var svg = d3.select("body").append("svg")
                .attr("width", width)
                .attr("height", height);
                
            var coordinates = []
            d3.csv("data.csv", function(data) {
                    console.log(data)
                    coordinates = data.map(function(d) { return [ +d["BEGIN_LON"], +d["BEGIN_LAT"] ]; });
            });
            console.log(coordinates)
            d3.json("us.json", function(error, us) {
                svg.insert("path", ".graticule")
                    .datum(topojson.feature(us, us.objects.land))
                    .attr("class", "land")
                    .attr("d", path);
                svg.insert("path", ".graticule")
                    .datum(topojson.mesh(us, us.objects.counties, function(a, b) { return a !== b && !(a.id / 1000 ^ b.id / 1000); }))
                    .attr("class", "county-boundary")
                    .attr("d", path);
                svg.selectAll(".pin")
                    .data(coordinates)
                    .enter().append("circle", ".pin")
                    .attr("r", 5)
                    .attr("transform", function(d) {
                        return "translate(" + projection([
                                        d.Longitude + "," +
                                        d.Latitude]) + ")"
                        });
                        
                    /*svg.insert("path", ".graticule")
                        .datum(topojson.mesh(us, us.objects.states, function(a, b) { return a !== b; }))
                        .attr("class", "state-boundary")
                        .attr("d", path);*/
            });
            d3.select(self.frameElement).style("height", height + "px");
            </script>
            Oh, hello.
        </body>
</html>
